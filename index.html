<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Graficador de Funciones Avanzado</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.11.0/math.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      text-align: center;
    }
    input, button {
      padding: 10px;
      margin: 10px;
      width: 300px;
    }
    #output {
      margin-top: 20px;
      font-size: 18px;
    }
  </style>
</head>
<body>

  <h2>Gráfico de Funciones Matemáticas</h2>
  <p>Ejemplos: <code>x^2 + 3*x - 4</code>, <code>2/(x-1)</code>, <code>sqrt(x)</code>, <code>log(x)</code>, <code>e^x</code></p>

  <input id="funcion" placeholder="Escribe la función: ej. x^2 - 4" />
  <button onclick="graficar()">Graficar</button>

  <div id="output"></div>
  <div id="grafico" style="width: 100%; height: 500px;"></div>

  <script>
    function graficar() {
      const input = document.getElementById("funcion").value;
      const output = document.getElementById("output");

      let expr;
      try {
        expr = math.parse(input);
        var f = expr.compile();
      } catch (e) {
        output.innerHTML = "Error: expresión no válida.";
        return;
      }

      let xValues = [];
      let yValues = [];
      let asintotas = [];

      for (let i = -100; i <= 100; i += 0.5) {
        let scope = {x: i};
        try {
          let y = f.evaluate(scope);
          if (!isFinite(y)) {
            yValues.push(null);
            asintotas.push(i);
          } else {
            yValues.push(y);
          }
        } catch (err) {
          yValues.push(null);
          asintotas.push(i);
        }
        xValues.push(i);
      }

      const trace = {
        x: xValues,
        y: yValues,
        mode: 'lines',
        name: 'f(x)',
        line: { color: 'blue' }
      };

      let shapes = asintotas.map(x0 => ({
        type: 'line',
        x0: x0, x1: x0,
        y0: -100, y1: 100,
        line: { color: 'red', width: 1, dash: 'dot' }
      }));

      Plotly.newPlot('grafico', [trace], {
        title: `Gráfico de f(x) = ${input}`,
        xaxis: { title: 'x' },
        yaxis: { title: 'f(x)', range: [-20, 20] },
        shapes: shapes
      });

      const dominio = asintotas.length > 0
        ? `Todos los reales excepto: x = ${[...new Set(asintotas.map(a => a.toFixed(2)))].join(", ")}`
        : "Todos los reales ℝ";

      let yFiltrado = yValues.filter(v => v !== null && isFinite(v));
      let min = Math.min(...yFiltrado);
      let max = Math.max(...yFiltrado);
      const rango = `Desde aproximadamente ${min.toFixed(2)} hasta ${max.toFixed(2)}`;

      const resultadoTexto = `Dominio: ${dominio}<br>Rango: ${rango}`;
      output.innerHTML = resultadoTexto;
      hablar(`El dominio es ${dominio}. El rango es de ${min.toFixed(2)} a ${max.toFixed(2)}.`);
    }

    function hablar(texto) {
      const speech = new SpeechSynthesisUtterance();
      speech.lang = "es-ES";
      speech.text = texto;
      window.speechSynthesis.speak(speech);
    }
  </script>

</body>
</html>
