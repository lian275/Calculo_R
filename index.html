<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Funciones Lineales y Cuadr√°ticas</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.11.0/math.min.js"></script>
  <style>
    body { font-family: Arial; padding: 20px; background: #f2f2f2; }
    input, button { padding: 10px; margin: 5px; font-size: 16px; }
    #grafico { margin-top: 20px; }
    #bot-explica { background: #e8f5e9; padding: 15px; border-radius: 10px; margin-top: 20px; }
  </style>
</head>
<body>

<h2>üìò Funciones Lineales y Cuadr√°ticas con Bot y As√≠ntotas</h2>
<p>Ejemplos v√°lidos: <code>2*x + 4</code> | <code>x^2 - 4</code> | <code>1 / (x - 2)</code></p>

<input type="text" id="funcion" placeholder="Ej: x^2 - 4" size="40">
<button onclick="graficarFuncion()">Graficar</button>
<button onclick="leerBot()">üîä Leer</button>

<div id="resultado"></div>
<div id="grafico"></div>
<div id="bot-explica"></div>

<script>
  let ultimaExplicacion = "";

  function graficarFuncion() {
    const input = document.getElementById("funcion").value;
    const res = document.getElementById("resultado");
    const bot = document.getElementById("bot-explica");
    const node = math.parse(input);
    const compiled = node.compile();
    const f = x => {
      try {
        return compiled.evaluate({x});
      } catch { return NaN; }
    };

    let tipo = "lineal";
    if (input.includes("x^2")) tipo = "cuadr√°tica";
    if (input.includes("/")) tipo = "racional";

    let dominio = "‚Ñù (todos los reales)";
    let rango = "";
    let asintotasV = [], asintotaH = null;
    let color = tipo === "lineal" ? "orange" : tipo === "cuadr√°tica" ? "blue" : "purple";

    try {
      if (tipo === "cuadr√°tica") {
        const f0 = f(0), f1 = f(1), f2 = f(2);
        const a = (f2 - 2 * f1 + f0);
        const b = f1 - f0 - a;
        const xV = -b / (2 * a);
        const yV = f(xV);
        rango = a > 0 ? `[${yV.toFixed(2)}, ‚àû)` : `(-‚àû, ${yV.toFixed(2)}]`;
      } else {
        rango = "‚Ñù (todos los reales)";
      }

      for (let x = -100; x <= 100; x += 0.1) {
        const y = f(x);
        if (!isFinite(y)) asintotasV.push(parseFloat(x.toFixed(1)));
      }
      asintotasV = [...new Set(asintotasV)];

      if (tipo === "racional") {
        const limite = f(1e5);
        asintotaH = isFinite(limite) ? `y = ${limite.toFixed(2)}` : "y = 0";
      }

      let x_vals = [], y_vals = [], puntos = {x: [], y: []};
      for (let x = -20; x <= 20; x += 0.1) {
        const y = f(x);
        if (isFinite(y)) {
          x_vals.push(x);
          y_vals.push(y);
          if (Number.isInteger(x)) {
            puntos.x.push(x);
            puntos.y.push(y);
          }
        }
      }

      const grafico = [{
        x: x_vals,
        y: y_vals,
        mode: 'lines',
        name: 'f(x)',
        line: { color: color }
      }, {
        x: puntos.x,
        y: puntos.y,
        mode: 'markers',
        name: 'Puntos enteros',
        marker: { color: 'black', size: 6, symbol: 'circle' }
      }];

      asintotasV.forEach(x => {
        grafico.push({
          x: [x, x],
          y: [-100, 100],
          mode: 'lines',
          name: 'As√≠ntota vertical',
          line: { dash: 'dash', color: 'red' }
        });
      });

      if (asintotaH) {
        const yVal = parseFloat(asintotaH.split("=")[1]);
        grafico.push({
          x: [-20, 20],
          y: [yVal, yVal],
          mode: 'lines',
          name: 'As√≠ntota horizontal',
          line: { dash: 'dot', color: 'green' }
        });
      }

      Plotly.newPlot("grafico", grafico, {
        title: `Gr√°fica de f(x) = ${input}`,
        xaxis: { title: 'x', range: [-20, 20] },
        yaxis: { title: 'f(x)' }
      });

      res.innerHTML = `
        <p><strong>üîç Tipo:</strong> Funci√≥n ${tipo}</p>
        <p><strong>üîë Dominio:</strong> ${dominio}</p>
        <p><strong>üìà Rango:</strong> ${rango}</p>
        <p><strong>‚ÜïÔ∏è As√≠ntotas verticales:</strong> ${asintotasV.length ? asintotasV.join(", ") : "Ninguna"}</p>
        <p><strong>‚ÜîÔ∏è As√≠ntota horizontal:</strong> ${asintotaH ? asintotaH : "Ninguna"}</p>
      `;

      let explicacion = `Has ingresado una funci√≥n ${tipo}. `;
      explicacion += `El dominio es todos los reales. El rango es ${rango}. `;
      if (asintotasV.length) explicacion += `Tiene as√≠ntotas verticales en x igual a ${asintotasV.join(", ")}. `;
      if (asintotaH) explicacion += `Tiene as√≠ntota horizontal en ${asintotaH}.`;
      bot.innerHTML = `<p>ü§ñ <strong>Bot:</strong> ${explicacion}</p>`;
      ultimaExplicacion = explicacion;

    } catch (e) {
      res.innerHTML = "<p style='color:red;'>‚ùå Error al procesar la funci√≥n.</p>";
      Plotly.purge("grafico");
      bot.innerHTML = "";
    }
  }

  function leerBot() {
    if ('speechSynthesis' in window) {
      const voz = new SpeechSynthesisUtterance(ultimaExplicacion);
      voz.lang = "es-ES";
      voz.rate = 1;
      speechSynthesis.cancel();
      speechSynthesis.speak(voz);
    } else {
      alert("Tu navegador no soporta voz.");
    }
  }
</script>

</body>
</html>
