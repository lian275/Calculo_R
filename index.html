<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Funciones Lineales y Cuadr√°ticas con Asintotas</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f0f0f0; }
    input, button { padding: 10px; margin: 5px; font-size: 16px; }
    #grafico { margin-top: 20px; }
    #bot-explica { margin-top: 20px; background: #e0f7fa; padding: 15px; border-radius: 10px; }
  </style>
</head>
<body>

<h2>üìä Funciones Lineales y Cuadr√°ticas + Dominio/Rango/Gr√°fica + Bot de Voz</h2>
<p>Ejemplos: <code>2*x + 4 = 0</code> | <code>x**2 - 4 = 0</code></p>

<input type="text" id="ecuacion" placeholder="Ej: x**2 - 4 = 0" size="40">
<button onclick="resolver()">Resolver</button>
<button onclick="leerBot()">üîä Leer</button>

<div id="resultado"></div>
<div id="grafico"></div>
<div id="bot-explica"></div>

<script>
  let ultimaExplicacion = "";

  function resolver() {
    const input = document.getElementById("ecuacion").value;
    const partes = input.split("=");
    const res = document.getElementById("resultado");
    const bot = document.getElementById("bot-explica");

    if (partes.length !== 2) {
      res.innerHTML = "<p style='color:red;'>‚ùå Usa el formato ax + b = 0 o ax¬≤ + bx + c = 0</p>";
      return;
    }

    const izq = partes[0];
    const der = partes[1];
    const f = x => eval(izq.replace(/x/g, `(${x})`)) - eval(der.replace(/x/g, `(${x})`));

    const tipo = izq.includes("x**2") || izq.includes("x*x") ? "cuadr√°tica" : "lineal";
    let solucionTexto = "", soluciones = [];
    let dominio = "‚Ñù";
    let rango = "";
    let color = tipo === "lineal" ? "orange" : "blue";

    try {
      if (tipo === "lineal") {
        const a = eval(izq.replace(/x/g, '(1)')) - eval(izq.replace(/x/g, '(0)'));
        const b = eval(izq.replace(/x/g, '(0)')) - eval(der);
        if (a === 0) {
          solucionTexto = b === 0 ? "Infinitas soluciones" : "No tiene soluci√≥n";
        } else {
          const x = -b / a;
          solucionTexto = `x = ${x.toFixed(2)}`;
          soluciones.push(x);
        }
        rango = "‚Ñù";
      } else {
        const f0 = f(0), f1 = f(1), f2 = f(2);
        const a = (f2 - 2 * f1 + f0);
        const b = f1 - f0 - a;
        const c = f0;
        const D = b * b - 4 * a * c;

        if (D < 0) {
          solucionTexto = "No tiene soluciones reales";
        } else if (D === 0) {
          const x = -b / (2 * a);
          solucionTexto = `x = ${x.toFixed(2)}`;
          soluciones.push(x);
        } else {
          const x1 = (-b + Math.sqrt(D)) / (2 * a);
          const x2 = (-b - Math.sqrt(D)) / (2 * a);
          solucionTexto = `x‚ÇÅ = ${x1.toFixed(2)}, x‚ÇÇ = ${x2.toFixed(2)}`;
          soluciones.push(x1, x2);
        }

        const xV = -b / (2 * a);
        const yV = f(xV);
        rango = a > 0 ? `[${yV.toFixed(2)}, ‚àû)` : `(-‚àû, ${yV.toFixed(2)}]`;
      }

      // Datos para gr√°fica
      let x_vals = [], y_vals = [];
      for (let i = -20; i <= 20; i += 0.1) {
        let y = f(i);
        if (isFinite(y)) {
          x_vals.push(i);
          y_vals.push(y);
        }
      }

      // Graficar funci√≥n principal
      const grafico = [{
        x: x_vals,
        y: y_vals,
        mode: 'lines',
        name: 'f(x)',
        line: { color: color }
      }];

      // Agregar as√≠ntotas verticales (si fueran funciones racionales futuras)
      // Ejemplo para demostrar: as√≠ntota en x = 2
      // grafico.push({
      //   x: [2, 2],
      //   y: [-100, 100],
      //   mode: 'lines',
      //   name: 'As√≠ntota vertical',
      //   line: { dash: 'dash', color: 'red' }
      // });

      // Graficar soluciones (si hay)
      soluciones.forEach(x => {
        grafico.push({
          x: [x],
          y: [0],
          mode: 'markers',
          marker: { color: 'red', size: 8 },
          name: 'Soluci√≥n'
        });
      });

      Plotly.newPlot("grafico", grafico, {
        title: `Gr√°fica de f(x) = ${izq} - (${der})`,
        xaxis: { title: 'x', range: [-20, 20] },
        yaxis: { title: 'f(x)' }
      });

      res.innerHTML = `
        <p><strong>üßÆ Tipo:</strong> Funci√≥n ${tipo}</p>
        <p><strong>‚úÖ Soluci√≥n:</strong> ${solucionTexto}</p>
        <p><strong>üìà Dominio exacto:</strong> ${dominio}</p>
        <p><strong>üìâ Rango exacto:</strong> ${rango}</p>
      `;

      // Bot texto
      let explicacion = `Has ingresado una funci√≥n ${tipo}. `;
      explicacion += `La soluci√≥n de la ecuaci√≥n es: ${solucionTexto}. `;
      explicacion += `El dominio es todos los reales. `;
      explicacion += `El rango exacto es: ${rango}.`;
      bot.innerHTML = `<p>ü§ñ <strong>Bot:</strong> ${explicacion}</p>`;
      ultimaExplicacion = explicacion;

    } catch (e) {
      res.innerHTML = "<p style='color:red;'>‚ùå Error al procesar la funci√≥n.</p>";
      Plotly.purge("grafico");
      bot.innerHTML = "";
    }
  }

  function leerBot() {
    if ('speechSynthesis' in window) {
      const voz = new SpeechSynthesisUtterance(ultimaExplicacion);
      voz.lang = "es-ES";
      voz.rate = 1;
      speechSynthesis.cancel();
      speechSynthesis.speak(voz);
    } else {
      alert("Tu navegador no soporta voz.");
    }
  }
</script>

</body>
</html>
