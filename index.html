<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Ecuaciones Lineales y Cuadr√°ticas con Voz</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f0f0f0;
      padding: 20px;
    }
    input, button {
      padding: 10px;
      margin: 5px;
      font-size: 16px;
    }
    #grafico {
      margin-top: 20px;
    }
    #bot-explica {
      background: #e0f7fa;
      padding: 15px;
      margin-top: 20px;
      border-radius: 10px;
    }
  </style>
</head>
<body>

  <h2>üìä Resolver Ecuaciones Lineales y Cuadr√°ticas + Bot de Voz</h2>
  <p>Ejemplos: <code>2*x + 4 = 0</code> | <code>x**2 - 4 = 0</code></p>

  <input type="text" id="ecuacion" placeholder="Ej: x**2 - 4 = 0" size="35">
  <button onclick="resolver()">Resolver</button>
  <button onclick="leerBot()">üîä Leer en voz alta</button>

  <div id="resultado"></div>
  <div id="grafico"></div>
  <div id="bot-explica"></div>

  <script>
    let ultimaExplicacion = "";

    function resolver() {
      const input = document.getElementById("ecuacion").value;
      const partes = input.split("=");
      const res = document.getElementById("resultado");
      const bot = document.getElementById("bot-explica");

      if (partes.length !== 2) {
        res.innerHTML = "<p style='color:red;'>‚ùå Ecuaci√≥n inv√°lida. Usa el formato ax + b = 0 o ax¬≤ + bx + c = 0</p>";
        return;
      }

      const izq = partes[0];
      const der = partes[1];
      const fx = x => eval(izq.replace(/x/g, `(${x})`)) - eval(der.replace(/x/g, `(${x})`));

      // Tipo de funci√≥n
      const tipo = izq.includes("x**2") || izq.includes("x*x") ? "cuadr√°tica" : "lineal";
      let solucionTexto = "";
      let soluciones = [];

      try {
        if (tipo === "lineal") {
          const a = eval(izq.replace(/x/g, '(1)')) - eval(izq.replace(/x/g, '(0)'));
          const b = eval(izq.replace(/x/g, '(0)')) - eval(der);
          if (a === 0) {
            solucionTexto = b === 0 ? "Infinitas soluciones" : "No tiene soluci√≥n";
          } else {
            const x = -b / a;
            solucionTexto = `x = ${x.toFixed(2)}`;
            soluciones.push(x);
          }
        } else {
          const f0 = fx(0), f1 = fx(1), f2 = fx(2);
          const a = (f2 - 2*f1 + f0) / 1;
          const b = f1 - f0 - a;
          const c = f0;
          const d = b**2 - 4*a*c;
          if (d < 0) {
            solucionTexto = "No tiene soluciones reales";
          } else if (d === 0) {
            const x = -b / (2*a);
            solucionTexto = `x = ${x.toFixed(2)}`;
            soluciones.push(x);
          } else {
            const x1 = (-b + Math.sqrt(d)) / (2*a);
            const x2 = (-b - Math.sqrt(d)) / (2*a);
            solucionTexto = `x‚ÇÅ = ${x1.toFixed(2)}, x‚ÇÇ = ${x2.toFixed(2)}`;
            soluciones.push(x1, x2);
          }
        }

        // Dominio y rango
        let x_vals = [], y_vals = [];
        for (let i = -20; i <= 20; i += 0.1) {
          try {
            const y = fx(i);
            if (isFinite(y)) {
              x_vals.push(i);
              y_vals.push(y);
            }
          } catch {}
        }
        const rangoMin = Math.min(...y_vals).toFixed(2);
        const rangoMax = Math.max(...y_vals).toFixed(2);

        res.innerHTML = `
          <p><strong>üìò Tipo:</strong> Funci√≥n ${tipo}</p>
          <p><strong>‚úÖ Soluci√≥n:</strong> ${solucionTexto}</p>
          <p><strong>üìà Dominio:</strong> ‚Ñù</p>
          <p><strong>üìâ Rango aproximado:</strong> [${rangoMin}, ${rangoMax}]</p>
        `;

        Plotly.newPlot("grafico", [{
          x: x_vals,
          y: y_vals,
          mode: 'lines',
          line: { color: 'blue' },
          name: 'f(x)'
        }], {
          title: `Gr√°fica de f(x) = ${izq} - (${der})`,
          xaxis: { title: 'x', range: [-20, 20] },
          yaxis: { title: 'f(x)', range: [parseFloat(rangoMin) - 5, parseFloat(rangoMax) + 5] }
        });

        // Bot de texto
        let expl = `Has ingresado una funci√≥n ${tipo}. `;
        expl += `La soluci√≥n de la ecuaci√≥n es: ${solucionTexto}. `;
        expl += `El dominio es todos los reales. El rango aproximado va de ${rangoMin} a ${rangoMax}.`;
        bot.innerHTML = `<p>ü§ñ <strong>Bot:</strong> ${expl}</p>`;
        ultimaExplicacion = expl;

      } catch (err) {
        res.innerHTML = "<p style='color:red;'>‚ùå Error al procesar la ecuaci√≥n.</p>";
        Plotly.purge("grafico");
        bot.innerHTML = "";
      }
    }

    function leerBot() {
      if ('speechSynthesis' in window) {
        const voz = new SpeechSynthesisUtterance(ultimaExplicacion);
        voz.lang = "es-ES";
        voz.rate = 1;
        speechSynthesis.cancel(); // Cancelar cualquier voz previa
        speechSynthesis.speak(voz);
      } else {
        alert("Tu navegador no soporta voz.");
      }
    }
  </script>

</body>
</html>
