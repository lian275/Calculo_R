<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Calculadora de Funciones</title>
  <script src="https://cdn.jsdelivr.net/npm/mathjs@11/lib/browser/math.min.js"></script>
  <script src="https://cdn.plot.ly/plotly-2.26.0.min.js"></script>
  <style>
    body {
      font-family: Arial;
      margin: 20px;
    }
    input, button {
      padding: 10px;
      margin: 5px;
      font-size: 16px;
    }
    #resultados {
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h2>Calculadora de Funciones (Lineales, Cuadr√°ticas y Racionales)</h2>
  <label for="funcion">Escribe una funci√≥n (por ejemplo: x^2 + 3*x - 4 o 2/(x-1)):</label><br>
  <input type="text" id="funcion" placeholder="Ej: x^2 - 4, 3*x + 2, 2/(x-1)">
  <button onclick="resolverFuncion()">Resolver</button>
  <button onclick="hablar()">üîä Leer Resultados</button>
  
  <div id="resultados"></div>
  <div id="grafico" style="width:100%;height:500px;"></div>

  <script>
    let descripcion = "";

    function resolverFuncion() {
      const expresion = document.getElementById("funcion").value;
      const expr = math.parse(expresion);
      const f = expr.compile();

      let xValores = [];
      let yValores = [];
      let asintotasVerticales = [];

      for (let i = -50; i <= 50; i += 0.1) {
        let x = math.round(i, 3);
        try {
          const y = f.evaluate({ x });
          if (Math.abs(y) > 1e5) {
            yValores.push(null); // Evita valores infinitos
            xValores.push(x);
            asintotasVerticales.push(x);
          } else {
            xValores.push(x);
            yValores.push(y);
          }
        } catch (e) {
          xValores.push(x);
          yValores.push(null);
          asintotasVerticales.push(x);
        }
      }

      // Calcular dominio
      let dominio = "Todos los reales";
      if (expresion.includes("/")) {
        const partes = expresion.split("/");
        if (partes[1]) {
          const denominador = math.parse(partes[1]);
          const zeros = math.roots(denominador.toString());
          dominio = ‚Ñù excepto x = ${zeros.map(z => math.round(z, 2)).join(", ")};
        }
      }

      // Rango aproximado
      let yFiltrado = yValores.filter(y => y !== null && isFinite(y));
      const minY = Math.min(...yFiltrado);
      const maxY = Math.max(...yFiltrado);
      let rango = Aproximadamente de y = ${minY.toFixed(2)} a y = ${maxY.toFixed(2)};

      // Asintotas horizontales
      let asintotaHorizontal = null;
      if (expresion.includes("/")) {
        const partes = expresion.split("/");
        const numerador = math.parse(partes[0]);
        const denominador = math.parse(partes[1]);

        const gradoNum = numerador.compile().toString().split('x').length - 1;
        const gradoDen = denominador.compile().toString().split('x').length - 1;

        if (gradoNum < gradoDen) asintotaHorizontal = "y = 0";
        else if (gradoNum === gradoDen) {
          const coefNum = parseFloat(numerador.coefficients?.[0] || 1);
          const coefDen = parseFloat(denominador.coefficients?.[0] || 1);
          asintotaHorizontal = y = ${coefNum / coefDen};
        }
      }

      descripcion = Dominio: ${dominio}. Rango: ${rango}.;
      if (asintotasVerticales.length > 0) descripcion += ` As√≠ntotas verticales detectadas.`;
      if (asintotaHorizontal) descripcion += ` As√≠ntota horizontal: ${asintotaHorizontal}.`;

      document.getElementById("resultados").innerHTML = `
        <p><strong>Dominio:</strong> ${dominio}</p>
        <p><strong>Rango (aproximado):</strong> ${rango}</p>
        ${asintotasVerticales.length > 0 ? <p><strong>As√≠ntotas Verticales (estimadas):</strong> en valores donde y se vuelve infinito.</p> : ""}
        ${asintotaHorizontal ? <p><strong>As√≠ntota Horizontal:</strong> ${asintotaHorizontal}</p> : ""}
      `;

      const grafico = [
        {
          x: xValores,
          y: yValores,
          mode: 'lines',
          name: 'Funci√≥n',
          line: { color: 'blue' }
        }
      ];

      // Agregar as√≠ntotas verticales
      if (asintotasVerticales.length > 0) {
        const unicos = [...new Set(asintotasVerticales.map(x => x.toFixed(2)))];
        unicos.forEach(x => {
          grafico.push({
            x: [x, x],
            y: [minY - 10, maxY + 10],
            mode: 'lines',
            name: As√≠ntota x=${x},
            line: { color: 'red', dash: 'dashdot' },
            hoverinfo: "skip"
          });
        });
      }

      // Agregar as√≠ntota horizontal
      if (asintotaHorizontal) {
        const yValor = parseFloat(asintotaHorizontal.split("=")[1]);
        grafico.push({
          x: [-50, 50],
          y: [yValor, yValor],
          mode: 'lines',
          name: As√≠ntota Horizontal,
          line: { color: 'green', dash: 'dashdot' },
          hoverinfo: "skip"
        });
      }

      Plotly.newPlot('grafico', grafico, {
        title: Gr√°fica de y = ${expresion},
        xaxis: { title: 'x' },
        yaxis: { title: 'y' }
      });
    }

    function hablar() {
      const voz = new SpeechSynthesisUtterance(descripcion);
      voz.lang = "es-ES";
      window.speechSynthesis.speak(voz);
    }
  </script>
</body>
</html>
