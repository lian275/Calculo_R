<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Dominio y Rango de Funciones</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background-color: #f4f4f4;
    }
    input, button {
      padding: 10px;
      font-size: 16px;
      margin: 10px 0;
    }
    #grafico {
      margin-top: 20px;
    }
    #bot-explica {
      margin-top: 20px;
      background-color: #e0f7fa;
      padding: 15px;
      border-radius: 10px;
    }
  </style>
</head>
<body>

  <h2>Visualizador de Funciones: Dominio, Rango y Gr√°fica</h2>
  <p>Ingresa una funci√≥n en t√©rminos de <code>x</code>, por ejemplo: <code>x**2 - 4</code> o <code>2*x + 3</code></p>
  <input type="text" id="funcion" placeholder="Ingresa f(x)" />
  <button onclick="graficarFuncion()">Graficar</button>

  <div id="output"></div>
  <div id="grafico"></div>
  <div id="bot-explica"></div>

  <script>
    function graficarFuncion() {
      const expresion = document.getElementById("funcion").value;
      const output = document.getElementById("output");
      const bot = document.getElementById("bot-explica");
      let x = [], y = [];

      for (let i = -20; i <= 20; i += 0.1) {
        try {
          let xi = i;
          let yi = eval(expresion.replace(/x/g, `(${xi})`));
          if (typeof yi === 'number' && isFinite(yi)) {
            x.push(xi);
            y.push(yi);
          }
        } catch (e) {
          // Ignorar errores por dominio inv√°lido
        }
      }

      if (x.length === 0 || y.length === 0) {
        output.innerHTML = `<p style="color:red;">‚ö†Ô∏è No se pudo graficar la funci√≥n. Revisa la expresi√≥n o intenta otra funci√≥n.</p>`;
        bot.innerHTML = '';
        Plotly.purge("grafico");
        return;
      }

      const dominioMin = Math.min(...x);
      const dominioMax = Math.max(...x);
      const rangoMin = Math.min(...y);
      const rangoMax = Math.max(...y);

      output.innerHTML = `
        <p><strong>‚úÖ Dominio v√°lido:</strong> [${dominioMin.toFixed(2)}, ${dominioMax.toFixed(2)}]</p>
        <p><strong>‚úÖ Rango aproximado:</strong> [${rangoMin.toFixed(2)}, ${rangoMax.toFixed(2)}]</p>
      `;

      const trace = {
        x: x,
        y: y,
        mode: 'lines',
        line: { color: 'blue' },
        name: `f(x) = ${expresion}`
      };

      const layout = {
        title: `Gr√°fica de f(x) = ${expresion}`,
        xaxis: { title: 'x', range: [-20, 20] },
        yaxis: { title: 'f(x)', range: [rangoMin - 5, rangoMax + 5] }
      };

      Plotly.newPlot("grafico", [trace], layout);

      // BOT EXPLICATIVO
      let tipo = "desconocida";
      if (expresion.includes("x**2") || expresion.includes("x*x")) {
        tipo = "cuadr√°tica";
      } else if (expresion.includes("x")) {
        tipo = "lineal";
      }

      let explicacion = `ü§ñ <strong>Bot:</strong> Has graficado una funci√≥n <strong>${tipo}</strong>. `;

      if (tipo === "cuadr√°tica") {
        if (y[0] > y[Math.floor(y.length / 2)]) {
          explicacion += `La par√°bola abre hacia abajo y tiene un <strong>m√°ximo</strong>. `;
        } else {
          explicacion += `La par√°bola abre hacia arriba y tiene un <strong>m√≠nimo</strong>. `;
        }
      } else if (tipo === "lineal") {
        if (y[0] < y[y.length - 1]) {
          explicacion += `La funci√≥n es
