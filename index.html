<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Funciones Lineales y Cuadr√°ticas</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body { font-family: Arial; padding: 20px; background: #f2f2f2; }
    input, button { padding: 10px; margin: 5px; font-size: 16px; }
    #grafico { margin-top: 20px; }
    #bot-explica { background: #e8f5e9; padding: 15px; border-radius: 10px; margin-top: 20px; }
  </style>
</head>
<body>

<h2>üìò Funciones Lineales y Cuadr√°ticas con Bot y As√≠ntotas</h2>
<p>Ejemplos v√°lidos: <code>2*x + 4 = 0</code> | <code>x**2 - 4 = 0</code> | <code>1 / (x - 2) = 0</code></p>

<input type="text" id="ecuacion" placeholder="Ej: x**2 - 4 = 0" size="40">
<button onclick="resolver()">Resolver</button>
<button onclick="leerBot()">üîä Leer</button>

<div id="resultado"></div>
<div id="grafico"></div>
<div id="bot-explica"></div>

<script>
  let ultimaExplicacion = "";

  function resolver() {
    const input = document.getElementById("ecuacion").value;
    const partes = input.split("=");
    const res = document.getElementById("resultado");
    const bot = document.getElementById("bot-explica");

    if (partes.length !== 2) {
      res.innerHTML = "<p style='color:red;'>‚ùå Formato inv√°lido. Usa ax + b = 0 o ax¬≤ + bx + c = 0</p>";
      return;
    }

    const izq = partes[0];
    const der = partes[1];
    const f = x => {
      try {
        return eval(izq.replace(/x/g, `(${x})`)) - eval(der.replace(/x/g, `(${x})`));
      } catch { return NaN; }
    };

    const esCuadratica = izq.includes("x**2") || izq.includes("x*x");
    const esRacional = izq.includes("/") || der.includes("/");

    let tipo = "lineal";
    if (esCuadratica) tipo = "cuadr√°tica";
    else if (esRacional) tipo = "racional";

    let solucionTexto = "";
    let soluciones = [];
    let dominio = "‚Ñù";
    let rango = "";
    let asintotasV = [];
    let asintotaH = null;
    let color = tipo === "lineal" ? "orange" : tipo === "cuadr√°tica" ? "blue" : "purple";

    try {
      if (tipo === "lineal") {
        const a = eval(izq.replace(/x/g, '(1)')) - eval(izq.replace(/x/g, '(0)'));
        const b = eval(izq.replace(/x/g, '(0)')) - eval(der);
        const x = -b / a;
        solucionTexto = `x = ${x.toFixed(2)}`;
        soluciones.push(x);
        rango = "‚Ñù";
      } else if (tipo === "cuadr√°tica") {
        const f0 = f(0), f1 = f(1), f2 = f(2);
        const a = (f2 - 2 * f1 + f0);
        const b = f1 - f0 - a;
        const c = f0;
        const D = b * b - 4 * a * c;
        if (D < 0) {
          solucionTexto = "No tiene soluciones reales";
        } else if (D === 0) {
          const x = -b / (2 * a);
          solucionTexto = `x = ${x.toFixed(2)}`;
          soluciones.push(x);
        } else {
          const x1 = (-b + Math.sqrt(D)) / (2 * a);
          const x2 = (-b - Math.sqrt(D)) / (2 * a);
          solucionTexto = `x‚ÇÅ = ${x1.toFixed(2)}, x‚ÇÇ = ${x2.toFixed(2)}`;
          soluciones.push(x1, x2);
        }
        const xV = -b / (2 * a);
        const yV = f(xV);
        rango = a > 0 ? `[${yV.toFixed(2)}, ‚àû)` : `(-‚àû, ${yV.toFixed(2)}]`;
      } else {
        // Asintotas para racionales
        for (let x = -100; x <= 100; x++) {
          let y1 = izq.replace(/x/g, `(${x})`);
          if (y1.includes("/0")) asintotasV.push(x);
        }
        asintotaH = "y = 0";
        solucionTexto = "Calculado por an√°lisis racional.";
        rango = "Variable seg√∫n discontinuidades.";
      }

      // Generar puntos
      let x_vals = [], y_vals = [];
      for (let x = -20; x <= 20; x += 0.1) {
        const y = f(x);
        if (isFinite(y)) {
          x_vals.push(x);
          y_vals.push(y);
        }
      }

      // Graficar
      const grafico = [{
        x: x_vals,
        y: y_vals,
        mode: 'lines',
        name: 'f(x)',
        line: { color: color }
      }];

      soluciones.forEach(x => {
        grafico.push({
          x: [x],
          y: [0],
          mode: 'markers',
          marker: { color: 'red', size: 8 },
          name: 'Soluci√≥n'
        });
      });

      // As√≠ntotas verticales
      asintotasV.forEach(x => {
        grafico.push({
          x: [x, x],
          y: [-100, 100],
          mode: 'lines',
          name: 'As√≠ntota vertical',
          line: { dash: 'dash', color: 'red' }
        });
      });

      // As√≠ntota horizontal
      if (asintotaH === "y = 0") {
        grafico.push({
          x: [-20, 20],
          y: [0, 0],
          mode: 'lines',
          name: 'As√≠ntota horizontal',
          line: { dash: 'dot', color: 'green' }
        });
      }

      Plotly.newPlot("grafico", grafico, {
        title: `Gr√°fica de f(x) = ${izq} - (${der})`,
        xaxis: { title: 'x' },
        yaxis: { title: 'f(x)' }
      });

      // Mostrar resultados
      res.innerHTML = `
        <p><strong>üîç Tipo:</strong> Funci√≥n ${tipo}</p>
        <p><strong>‚úÖ Soluci√≥n:</strong> ${solucionTexto}</p>
        <p><strong>üìà Dominio:</strong> ${dominio}</p>
        <p><strong>üìâ Rango:</strong> ${rango}</p>
        <p><strong>üìè As√≠ntotas verticales:</strong> ${asintotasV.length ? asintotasV.join(", ") : "Ninguna"}</p>
        <p><strong>üìè As√≠ntota horizontal:</strong> ${asintotaH ? asintotaH : "Ninguna"}</p>
      `;

      // Bot de voz
      let explicacion = `Esta es una funci√≥n ${tipo}. La soluci√≥n es: ${solucionTexto}. `;
      explicacion += `El dominio es todos los reales. El rango es ${rango}. `;
      if (asintotasV.length > 0) explicacion += `Tiene as√≠ntotas verticales en x igual a ${asintotasV.join(", ")}. `;
      if (asintotaH) explicacion += `Tiene as√≠ntota horizontal en ${asintotaH}.`;
      bot.innerHTML = `<p>ü§ñ <strong>Bot:</strong> ${explicacion}</p>`;
      ultimaExplicacion = explicacion;

    } catch (e) {
      res.innerHTML = "<p style='color:red;'>‚ùå Error al procesar la funci√≥n.</p>";
      Plotly.purge("grafico");
      bot.innerHTML = "";
    }
  }

  function leerBot() {
    if ('speechSynthesis' in window) {
      const voz = new SpeechSynthesisUtterance(ultimaExplicacion);
      voz.lang = "es-ES";
      voz.rate = 1;
      speechSynthesis.cancel();
      speechSynthesis.speak(voz);
    } else {
      alert("Tu navegador no soporta voz.");
    }
  }
</script>

</body>
</html>
