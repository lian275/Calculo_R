<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Funciones Lineales y Cuadr√°ticas con Bot</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f4f4f4;
    }
    input, button {
      padding: 10px;
      font-size: 16px;
      margin: 10px 5px;
    }
    #grafico {
      margin-top: 20px;
    }
    #bot-explica {
      margin-top: 20px;
      background-color: #e0f7fa;
      padding: 15px;
      border-radius: 10px;
    }
  </style>
</head>
<body>

  <h2>üìä Resolver Funciones Lineales y Cuadr√°ticas + Bot de Voz</h2>
  <p>Ejemplos: <code>2*x + 4 = 0</code> | <code>x**2 - 4 = 0</code></p>

  <input type="text" id="ecuacion" placeholder="Ej: x**2 - 4 = 0" size="40">
  <button onclick="resolverFuncion()">Resolver</button>
  <button onclick="leerBot()">üîä Leer en Voz Alta</button>

  <div id="resultado"></div>
  <div id="grafico"></div>
  <div id="bot-explica"></div>

  <script>
    let ultimaExplicacion = "";

    function resolverFuncion() {
      const ecuacion = document.getElementById("ecuacion").value;
      const resultado = document.getElementById("resultado");
      const bot = document.getElementById("bot-explica");

      const partes = ecuacion.split("=");
      if (partes.length !== 2) {
        resultado.innerHTML = "<p style='color:red;'>‚ùå Formato inv√°lido. Usa ax + b = 0 o ax¬≤ + bx + c = 0</p>";
        return;
      }

      try {
        const izquierda = partes[0];
        const derecha = partes[1];
        const expr = x => eval(izquierda.replace(/x/g, `(${x})`)) - eval(derecha.replace(/x/g, `(${x})`));

        // Detecci√≥n de tipo de funci√≥n
        const isCuadratica = izquierda.includes("x**2") || izquierda.includes("x*x");
        const tipo = isCuadratica ? "cuadr√°tica" : "lineal";

        let solucion = "";

        if (tipo === "lineal") {
          const a = eval(izquierda.replace(/x/g, '(1)')) - eval(izquierda.replace(/x/g, '(0)'));
          const b = eval(izquierda.replace(/x/g, '(0)')) - eval(derecha);
          if (a === 0) {
            solucion = b === 0 ? "Infinitas soluciones" : "No tiene soluci√≥n";
          } else {
            const x = -b / a;
            solucion = `x = ${x.toFixed(2)}`;
          }
        } else {
          // cuadr√°tica: ax^2 + bx + c = 0
          const f0 = expr(0);
          const f1 = expr(1);
          const f2 = expr(2);
          const a = (f2 - 2 * f1 + f0) / 1; // segunda diferencia = 2a
          const b = f1 - f0 - a;
          const c = f0;
          const discriminante = b * b - 4 * a * c;

          if (discriminante < 0) {
            solucion = "No tiene soluciones reales";
          } else if (discriminante === 0) {
            const x = -b / (2 * a);
            solucion = `x = ${x.toFixed(2)}`;
          } else {
            const x1 = (-b + Math.sqrt(discriminante)) / (2 * a);
            const x2 = (-b - Math.sqrt(discriminante)) / (2 * a);
            solucion = `x‚ÇÅ = ${x1.toFixed(2)}, x‚ÇÇ = ${x2.toFixed(2)}`;
          }
        }

        // Dominio: ‚Ñù
        // Rango: estimado a partir de la funci√≥n evaluada
        let x_vals = [], y_vals = [];
        for (let i = -20; i <= 20; i += 0.1) {
          try {
            let y = expr(i);
            if (typeof y === "number" && isFinite(y)) {
              x_vals.push(i);
              y_vals.push(y);
            }
          } catch (_) {}
        }

        const rangoMin = Math.min(...y_vals).toFixed(2);
        const rangoMax = Math.max(...y_vals).toFixed(2);

        resultado.innerHTML = `
          <p><strong>üìò Funci√≥n asociada:</strong> f(x) = ${izquierda} - (${derecha})</p>
          <p><strong>‚úÖ Soluci√≥n:</strong> ${solucion}</p>
          <p><strong>üìà Dominio:</strong> ‚Ñù (todos los reales)</p>
          <p><strong>üìâ Rango aproximado:</strong> [${rangoMin}, ${rangoMax}]</p>
        `;

        Plotly.newPlot("grafico", [{
          x: x_vals,
          y: y_vals,
          mode: 'lines',
          name: 'f(x)',
          line: { color: 'blue' }
        }], {
          title: `Gr√°fica de la funci√≥n (${tipo})`,
          xaxis: { title: 'x', range: [-20, 20] },
          yaxis: { title: 'f(x)', range: [parseFloat(rangoMin) - 5, parseFloat(rangoMax) + 5] }
        });

        // BOT EXPLICATIVO
        let explicacion = `Has ingresado una funci√≥n ${tipo}. `;
        explicacion += `La soluci√≥n de la ecuaci√≥n es: ${solucion}. `;
        explicacion += `El dominio son todos los n√∫meros reales. `;
        explicacion += `El rango aproximado va de ${rangoMin} a ${rangoMax}.`;
        bot.innerHTML = `<p>ü§ñ <strong>Bot:</strong> ${explicacion}</p>`;
        ultimaExplicacion = explicacion;

      } catch (e) {
        resultado.innerHTML = "<p style='color:red;'>‚ùå Error en la funci√≥n. Revisa tu expresi√≥n.</p>";
        Plotly.purge("grafico");
        bot.innerHTML = "";
      }
    }

    function leerBot() {
      if ('speechSynthesis' in window) {
        const voz = new SpeechSynthesisUtterance(ultimaExplicacion);
        voz.lang = "es-ES";
        voz.rate = 1;
        window.speechSynthesis.cancel();
        window.speechSynthesis.speak(voz);
      } else {
        alert("Tu navegador no soporta voz.");
      }
    }
  </script>

</body>
</html>
