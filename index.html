<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Funciones Lineales y Cuadr√°ticas</title>
  <script src="https://cdn.jsdelivr.net/npm/mathjs@11/lib/browser/math.min.js"></script>
  <script src="https://cdn.plot.ly/plotly-2.26.0.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    input, button {
      font-size: 16px;
      padding: 10px;
      margin: 5px 0;
    }
    #resultados {
      margin-top: 20px;
    }
    #voz {
      background-color: #28a745;
      color: white;
      border: none;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <h2>Calculadora de Funciones</h2>
  <label>Ingresa una funci√≥n (por ejemplo: x^2 + 3*x - 4, 3*x + 2, 2/(x-1)):</label><br>
  <input type="text" id="funcion" size="40" placeholder="Ej: x^2 - 4, 2*x+5, 2/(x-1)">
  <button onclick="resolverFuncion()">Resolver</button>
  <button id="voz" onclick="leerResultados()">üîä Escuchar Resultados</button>

  <div id="resultados"></div>
  <div id="grafico" style="width:100%;height:500px;"></div>

  <script>
    let descripcion = "";

    function resolverFuncion() {
      const expresion = document.getElementById("funcion").value;
      if (!expresion) return alert("Por favor, ingresa una funci√≥n.");

      const expr = math.parse(expresion);
      const f = expr.compile();

      let xVals = [], yVals = [], asintotasV = [];
      for (let i = -50; i <= 50; i += 0.1) {
        const x = math.round(i, 3);
        try {
          const y = f.evaluate({ x });
          if (Math.abs(y) > 1e5) {
            yVals.push(null);
            xVals.push(x);
            asintotasV.push(x);
          } else {
            xVals.push(x);
            yVals.push(y);
          }
        } catch (e) {
          xVals.push(x);
          yVals.push(null);
          asintotasV.push(x);
        }
      }

      // Dominio
      let dominio = "‚Ñù (todos los reales)";
      if (expresion.includes("/")) {
        try {
          const partes = expresion.split("/");
          if (partes[1]) {
            const zeros = math.roots(math.parse(partes[1]));
            if (zeros.length > 0) {
              dominio = ‚Ñù excepto x = ${zeros.map(z => math.round(z, 2)).join(", ")};
            }
          }
        } catch (e) {
          dominio = "Indeterminado (revisar funci√≥n)";
        }
      }

      // Rango aproximado
      const yFiltrado = yVals.filter(y => y !== null && isFinite(y));
      const minY = Math.min(...yFiltrado);
      const maxY = Math.max(...yFiltrado);
      const rango = Aprox. y ‚àà [${minY.toFixed(2)}, ${maxY.toFixed(2)}];

      // As√≠ntota horizontal (caso racional)
      let asintotaH = "";
      if (expresion.includes("/")) {
        const partes = expresion.split("/");
        const num = partes[0];
        const den = partes[1];
        const gradoNum = (num.match(/x/g) || []).length;
        const gradoDen = (den.match(/x/g) || []).length;

        if (gradoNum < gradoDen) asintotaH = "y = 0";
        else if (gradoNum === gradoDen) {
          const coefNum = parseFloat(num.match(/-?\d*\.?\d+/)?.[0] || "1");
          const coefDen = parseFloat(den.match(/-?\d*\.?\d+/)?.[0] || "1");
          asintotaH = y = ${(coefNum / coefDen).toFixed(2)};
        }
      }

      // Guardar texto para el bot de voz
      descripcion = El dominio es: ${dominio}. El rango es: ${rango}.;
      if (asintotasV.length > 0) descripcion += ` Hay as√≠ntotas verticales visibles.`;
      if (asintotaH) descripcion += ` La as√≠ntota horizontal es: ${asintotaH}.`;

      // Mostrar resultados
      document.getElementById("resultados").innerHTML = `
        <p><strong>Dominio:</strong> ${dominio}</p>
        <p><strong>Rango:</strong> ${rango}</p>
        ${asintotasV.length > 0 ? "<p><strong>As√≠ntotas Verticales:</strong> visibles donde y ‚Üí ‚àû</p>" : ""}
        ${asintotaH ? <p><strong>As√≠ntota Horizontal:</strong> ${asintotaH}</p> : ""}
      `;

      // Gr√°fica
      const data = [{
        x: xVals,
        y: yVals,
        mode: "lines",
        name: "Funci√≥n",
        line: { color: "blue" }
      }];

      // As√≠ntotas verticales (rojo)
      const unicasAV = [...new Set(asintotasV.map(x => x.toFixed(2)))];
      unicasAV.forEach(x => {
        data.push({
          x: [x, x],
          y: [minY - 10, maxY + 10],
          mode: "lines",
          name: As. V x=${x},
          line: { color: "red", dash: "dashdot" },
          hoverinfo: "skip"
        });
      });

      // As√≠ntota horizontal (verde)
      if (asintotaH) {
        const yVal = parseFloat(asintotaH.split("=")[1]);
        data.push({
          x: [-50, 50],
          y: [yVal, yVal],
          mode: "lines",
          name: "As√≠ntota Horizontal",
          line: { color: "green", dash: "dashdot" },
          hoverinfo: "skip"
        });
      }

      Plotly.newPlot("grafico", data, {
        title: Gr√°fica de y = ${expresion},
        xaxis: { title: "x" },
        yaxis: { title: "y" }
      });
    }

    function leerResultados() {
      const voz = new SpeechSynthesisUtterance(descripcion);
      voz.lang = "es-ES";
      window.speechSynthesis.speak(voz);
    }
  </script>

</body>
</html>
