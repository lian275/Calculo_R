<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Analizador de Funciones</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.11.0/math.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f9fbfd;
      color: #222;
      padding: 20px;
    }
    input, button {
      font-size: 16px;
      padding: 10px;
      margin: 10px;
      width: 300px;
    }
    button {
      cursor: pointer;
      background: #1976d2;
      color: white;
      border: none;
      border-radius: 5px;
    }
    #grafico { margin-top: 30px; }
    #bot-explica {
      margin-top: 20px;
      background: #e3f2fd;
      padding: 15px;
      border-radius: 10px;
      font-style: italic;
    }
    #resultado p {
      margin: 5px 0;
    }
  </style>
</head>
<body>

<h2>üìò Analizador de Funciones Lineales, Cuadr√°ticas y Racionales</h2>
<p>Ejemplos: <code>2*x + 3</code>, <code>x^2 - 4</code>, <code>2 / (x - 2)</code></p>

<input type="text" id="funcion" placeholder="Ejemplo: 2 / (x - 2)">
<br>
<button onclick="graficarFuncion()">üìä Graficar</button>
<button onclick="leerBot()">üîä Escuchar Explicaci√≥n</button>

<div id="resultado"></div>
<div id="grafico"></div>
<div id="bot-explica"></div>

<script>
  let ultimaExplicacion = "";

  function graficarFuncion() {
    const entrada = document.getElementById("funcion").value.trim();
    const expresion = entrada.replace(/^y\s*=\s*/i, '');
    const res = document.getElementById("resultado");
    const bot = document.getElementById("bot-explica");

    let expr, compiled;
    try {
      expr = math.parse(expresion);
      compiled = expr.compile();
    } catch (e) {
      res.innerHTML = `<p style="color:red;">‚ùå Error: expresi√≥n inv√°lida.</p>`;
      Plotly.purge("grafico");
      bot.innerHTML = "";
      return;
    }

    const evaluar = x => {
      try {
        return compiled.evaluate({ x });
      } catch {
        return NaN;
      }
    };

    // Clasificaci√≥n
    let tipo = "lineal";
    if (/\bx\^2\b/.test(expresion)) tipo = "cuadr√°tica";
    else if (expresion.includes('/')) tipo = "racional";

    let color = tipo === "lineal" ? "orange" : tipo === "cuadr√°tica" ? "blue" : "purple";
    let dominio = "‚Ñù (todos los reales)";
    let rango = "‚Ñù";
    let asintotasV = [], asintotaH = null;

    // Rango para cuadr√°tica (usando coeficientes)
    if (tipo === "cuadr√°tica") {
      const coefs = math.simplify(expresion).coefficients();
      let a = coefs[0] || 0;
      let b = coefs[1] || 0;
      let c = coefs[2] || 0;
      const xV = -b / (2 * a);
      const yV = evaluar(xV);
      rango = a > 0 ? `[${yV.toFixed(2)}, ‚àû)` : `(-‚àû, ${yV.toFixed(2)}]`;
    }

    // As√≠ntotas verticales
    for (let x = -50; x <= 50; x += 0.2) {
      let y = evaluar(x);
      if (!isFinite(y)) asintotasV.push(Number(x.toFixed(2)));
    }
    asintotasV = [...new Set(asintotasV)];

    // As√≠ntota horizontal
    if (tipo === "racional") {
      let limite = evaluar(1e6);
      if (isFinite(limite)) asintotaH = `y = ${limite.toFixed(2)}`;
    }

    // Generar puntos
    let x_vals = [], y_vals = [], puntos = { x: [], y: [] };
    for (let x = -20; x <= 20; x += 0.1) {
      let y = evaluar(x);
      if (isFinite(y)) {
        x_vals.push(x);
        y_vals.push(y);
        if (Math.abs(x % 1) < 0.01) {
          puntos.x.push(x);
          puntos.y.push(y);
        }
      }
    }

    // Graficar
    const trazas = [
      {
        x: x_vals,
        y: y_vals,
        mode: 'lines',
        name: 'f(x)',
        line: { color }
      },
      {
        x: puntos.x,
        y: puntos.y,
        mode: 'markers',
        name: 'Puntos enteros',
        marker: { color: 'black', size: 5 }
      }
    ];

    asintotasV.forEach(x => {
      trazas.push({
        x: [x, x],
        y: [-100, 100],
        mode: 'lines',
        name: 'As√≠ntota vertical',
        line: { dash: 'dash', color: 'red' }
      });
    });

    if (asintotaH) {
      const yH = parseFloat(asintotaH.split("=")[1]);
      trazas.push({
        x: [-20, 20],
        y: [yH, yH],
        mode: 'lines',
        name: 'As√≠ntota horizontal',
        line: { dash: 'dot', color: 'green' }
      });
    }

    Plotly.newPlot("grafico", trazas, {
      title: `Gr√°fica de y = ${expresion}`,
      xaxis: { title: 'x', range: [-20, 20] },
      yaxis: { title: 'y' }
    });

    // Mostrar resultados
    res.innerHTML = `
      <p><strong>üìå Tipo:</strong> Funci√≥n ${tipo}</p>
      <p><strong>üîë Dominio:</strong> ${dominio}</p>
      <p><strong>üìà Rango:</strong> ${rango}</p>
      <p><strong>‚ÜïÔ∏è As√≠ntotas verticales:</strong> ${asintotasV.length ? asintotasV.join(', ') : 'Ninguna'}</p>
      <p><strong>‚ÜîÔ∏è As√≠ntota horizontal:</strong> ${asintotaH || 'Ninguna'}</p>
    `;

    // Bot de voz
    ultimaExplicacion = `Esta es una funci√≥n ${tipo}. El dominio es ${dominio}. El rango es ${rango}. `;
    if (asintotasV.length) ultimaExplicacion += `Tiene as√≠ntotas verticales en x igual a ${asintotasV.join(', ')}. `;
    if (asintotaH) ultimaExplicacion += `Y una as√≠ntota horizontal en ${asintotaH}.`;

    bot.innerHTML = `<strong>ü§ñ Bot:</strong> ${ultimaExplicacion}`;
  }

  function leerBot() {
    if ('speechSynthesis' in window && ultimaExplicacion) {
      const voz = new SpeechSynthesisUtterance(ultimaExplicacion);
      voz.lang = 'es-ES';
      voz.rate = 1;
      speechSynthesis.cancel(); // Cancela cualquier lectura anterior
      speechSynthesis.speak(voz);
    } else {
      alert('Tu navegador no soporta el bot de voz.');
    }
  }
</script>

</body>
</html>
